---
title: "Visualizing sea surface temperature, chlorophyll, and wind in the Santa Barbara Channel"
description: |
  Interpretting marine processes by combining multiple data sets.
author:
  - name: Juliet Cohen
    url: {}
date: 11-05-2021
output:
  distill::distill_article:
    self_contained: false
preview: Images/sst.png
categories:
  -R
---
## Data in the Santa Barbara Channel

The rocky Santa Barbara coast is known for its beautiful weather, incredible surfing, and unique geographic features. Among these are the 4 channel islands which reside between 12 and 27 miles off shore from Santa Barabara, Ventura, and Oxnard. These include Santa Cruz, Anacapa, Santa Rosa, and San Miguel. The Santa Barbara Channel is a hotspot for biodiversity, including dolphins, sunfish, and whales. During certain seasons, whale sightings are quite common from both boat and from the shore. The whales' feed on krill in the channel, which rely on chorophyll to bloom. We can detect this chlorophyll via satellites, just as we can detect sea surface temperature. While strategizing the best time of year to spot these whales, we might want to consider the timing of these phytoplankton blooms. Do these blooms occur more often when we have warmer ocean temperatures? What time of year would that be? Is the ocean temperature impacted by wind? A few data-driven friends and I decided to combine data about wind, sea surface temperature, and chlorophyll in the Santa Barbara Channel to find the best time of year to go whale watching.

Question: How did wind speed affect sea surface temperature and chlorophyll in the Santa Barbara Channel during 2020?

## The National Oceanic Atmospheric Administration (NOAA)

**Methods**  

The National Oceanic Atmospheric Administration has the perfect datasets to help us out, and they even have a handy application programming interface (API) to do the heavy lifting. Her

The REDDAP API will pull sea surface temperature and chlorophyll data from the NOAA Aquamodis Satelite into Rstudio. In addition, we manually pulled wind speed data from NOAA's East Buoy, West Buoy, and the Santa Monica Buoy by downloading and decompressing the 2020 Standard Meteorological Data Files available online (see below for links). To coordinate all the data for our analysis, we used the function rbind() to combine the datasets with time as the primary key.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval=FALSE)
```

```{r}
library(rerddap)
# used to load in the data from NOAA's website
library(tidyverse)
# used to clean and visualize data
library(here)
# used to read in the data from the current R project
library(lubridate)
# use lubridate to work with datetimes (parsing dates and changing the class)
```

```{r}
# Read in Aqua Modis Data from their website
require("rerddap")

# Sea Surface Temperature for each Buoy
E_sst <- griddap('erdMWsstd8day_LonPM180', # 8 day composite SST E_buoy
 time = c('2020-01-01T12:00:00Z','2021-01-01T12:00:00Z'), # Full year time period 2020
 latitude = c(34.0, 34.5), #grid surrounding buoy
 longitude = c(-119.5, -120), #grid surrounding buoy
 fmt = "csv")  %>% 
  add_column(location = "east") #add ID column

W_sst <- griddap('erdMWsstd8day_LonPM180', # 8 day composite SST W_buoy
 time = c('2020-01-01T12:00:00Z','2021-01-01T12:00:00Z'), # Full year time period 2020
 latitude = c(34.0, 34.5), #grid surrounding buoy
 longitude = c(-120, -120.5), #grid surrounding buoy
 fmt = "csv") %>% 
  add_column(location = "west") #add ID column

SM_sst <- griddap('erdMWsstd8day_LonPM180', # 8 day composite SST SM_buoy
 time = c('2020-01-01T12:00:00Z','2021-01-01T12:00:00Z'), # Full year time period 2020
 latitude = c(33.5, 34.0), #grid surrounding buoy
 longitude = c(-118.75, -119.25), #grid surrounding buoy
 fmt = "csv") %>%
  add_column(location = "SM") #add ID column

sst <- rbind(E_sst, W_sst, SM_sst) #bind data

#----------------------------------------------------------------------------------------

# Chloro for each Buoy
E_chloro <- griddap('erdMWchla8day_LonPM180',  # 8 day composite Chlorophyll E_buoy
  time = c('2020-01-01T12:00:00Z','2021-01-01T12:00:00Z'), # Full year time period 2020
  latitude = c(34.0, 34.5), #grid surrounding buoy
  longitude = c(-119.5, -120), #grid surrounding buoy
  fmt = "csv") %>% 
  add_column(location = "east") #add location term

W_chloro <- griddap('erdMWchla8day_LonPM180', # 8 day composite Chlorophyll E_buoy
  time = c('2020-01-01T12:00:00Z','2021-01-01T12:00:00Z'), # Full year time period 2020
  latitude = c(34.0, 34.5), #grid surrounding buoy
  longitude = c(-120, -120.5), #grid surrounding buoy
  fmt = "csv") %>% 
  add_column(location = "west") #add location term

SM_chloro <- griddap('erdMWchla8day_LonPM180', # 8 day composite Chlorophyll SM_buoy
  time = c('2020-01-01T12:00:00Z','2021-01-01T12:00:00Z'), # Full year time period 2020
  latitude = c(33.5, 34.0), #grid surrounding buoy
  longitude = c(-118.75, -119.25), #grid surrounding buoy
  fmt = "csv")%>% 
  add_column(location = "SM") #add location term

chloro <- rbind(E_chloro, W_chloro, SM_chloro) #Bind data

#----------------------------------------------------------------------------------------

# Wind data for each buoy and data cleaning
tab_E <- read.table(here("data","east_wind.txt"), comment="", header=TRUE) #convert .txt file to .csv
write.csv(tab_E, "east_wind.csv", row.names=F, quote=F)

E_wind <- read.csv(here("east_wind.csv")) %>% # read in .csv, select columns and rename
  add_column(location = "east") %>% 
  select(c("X.YY", "MM", "DD", "WSPD", "location"))  %>% 
  rename(year = X.YY,
         month = MM,
         day = DD)
E_wind <- E_wind[-c(1),]
  

tab_W <- read.table(here("data","west_wind.txt"), comment="", header=TRUE) #convert .txt file to .csv
write.csv(tab_W, "west_wind.csv", row.names=F, quote=F)

W_wind <- read.csv(here("west_wind.csv"))%>% # read in .csv, select coloumns and rename
  add_column(location = "west") %>% 
  select(c("X.YY", "MM", "DD", "WSPD", "location"))  %>% 
  rename(year = X.YY,
         month = MM,
         day = DD)
W_wind <- W_wind[-c(1),]


tab_SM <- read.table(here("data","SM_wind.txt"), comment="", header=TRUE) #convert .txt file to .csv
write.csv(tab_SM, "SM_wind.csv", row.names=F, quote=F)

SM_wind <- read.csv(here("SM_wind.csv"))%>% # read in .csv, select coloumns and rename
  add_column(location = "SM") %>% 
  select(c("X.YY", "MM", "DD", "WSPD", "location"))  %>% 
  rename(year = X.YY,
         month = MM,
         day = DD)
SM_wind <- SM_wind[-c(1),]

wind <- rbind(E_wind, W_wind, SM_wind) #bind data


```

We averaged the wind by month rather than day, as we did for the other 2 variables, because the wind varies more each day by a large margin. Therefore, the wind data on a daily basis shows lots of noise and no interpretable trends. On a monthly scale, however, we can make sense of its broader fluctuations over the year.

```{r}
# clean date format and summarize with daily means for wind

wind <- wind %>%
  unite("date", year:month:day, sep = "-") %>% 
  mutate(date = ymd(date, tz = NULL)) %>% 
  mutate(WSPD = as.numeric(WSPD))

# see the data join chunk for na.rm explanation in code comment

wind_avg <- wind %>% 
  group_by(location, date) %>% 
  summarize(mean_wind = mean(WSPD, na.rm = T))

```

Here we cleaned the remotely-sensed sea surface temperature data and summarized it by day:

```{r}
# clean data for sst date
sst_clean <- sst %>% 
  mutate(date = ymd_hms(time, tz = "UTC")) %>% 
  mutate(ymd_date = ymd(date, tz = NULL)) %>% 
  mutate(date = ymd_date) %>% 
  select(c("latitude", "longitude", "sst", "location", "date"))
```


```{r}
# Clean sst Data and summarize by daily means
final_sst <- sst_clean %>% 
  filter(sst > 0) %>% #remove NAs
  mutate(sst = (sst * (9/5) + 32 )) %>% #convert to F
  mutate(sst = (sst - 3)) #accounting for SST satellite error through anecdotal and buoy comparison. Jake's field experience justifies this as he has consistently cross-referenced the satellite data with in situ measurements 

# see the data join chunk for na.rm explanation in code comment

final_sst_avg <- final_sst %>% 
  group_by(location, date) %>% 
  summarize(mean_sst = mean(sst, na.rm = T))
```

Here we cleaned the remotely-sensed chlorophyll data and summarized it by day:

```{r}
# clean chloro data
# see the data join chunk for na.rm explanation in code comment

chloro_clean <- chloro %>% 
  mutate(date = ymd_hms(time, tz = "UTC")) %>% 
  mutate(ymd_date = ymd(date, tz = NULL)) %>% 
  mutate(date = ymd_date) %>% 
  select(c("latitude", "longitude", "chlorophyll", "location", "date"))

final_chloro_avg <- chloro_clean %>% 
  group_by(location, date) %>%
  summarize(mean_chloro = mean(chlorophyll, na.rm = T))

```

We used inner_join() in 2 steps to combine the cleaned data from the 3 variables into one dataframe:

```{r}
# combine daily wind and sst and chloro means
# we decided to use inner join in order to not include any rows that lack values for ANY of the 3 variables. We do not want any NA values in one col and have data in another col, because when we map everything together that data would be represented as if there was a zero value for the variable that had NA. This change reduced the amount of rows by a couple hundred. This was primarily in the SST and cholorophyll data which had plenty of NA's but the wind data did not initially have NA's.

wind_sst <- inner_join(wind_avg, final_sst_avg, by = c("date", "location"))

chloro_wind_sst <- inner_join(wind_sst, final_chloro_avg, by = c("date", "location"))

```

Now the fun part: visualization! We made 3 plots separated by variable, representing data from all 3 buoys. We marked the sea surface temperature maximum in all 3 plots since the combined data seems to reveal a temporal correlation between sea surface temperature and wind.

```{r}
# Daily Average Sea Surface Temperature from East, West, and Santa Monica Buoys

ggplot(data = chloro_wind_sst, aes(x = date, y = mean_sst, color = location)) +
  geom_line() +
  labs(x = "Date",
       y = "Daily Average Sea Surface Temperature (degC)",
       title = "Daily Average Sea Surface Temperature from East, West, and Santa Monica Buoys",
       color = "Location")
```


```{r}
# Monthly Average Wind from East, West, and Santa Monica Buoys

month_mean <- chloro_wind_sst %>%
  select(location, date, mean_wind) %>%
  mutate(month = month(date, label = TRUE)) %>%
  mutate(month = as.numeric(month)) %>% 
  group_by(location, month) %>%
  summarize(mean_wind = mean(mean_wind, na.rm = T)) 

ggplot(data = month_mean, aes(x = month, y = mean_wind, color = location)) +
  geom_line() +
  labs(x = "Month",
       y = "Monthly Average Wind Speed (knots)",
       title = "Monthly Average Wind Speeds from East, West, and Santa Monica Buoys",
       color = "Location") +
  ylim(0,15) +
  scale_x_discrete(limits=month.abb)

# Daily Average Chorophyll from East, West, and Santa Monica Buoys

ggplot(data = chloro_wind_sst, aes(x = date, y = mean_chloro, color = location)) +
  geom_line() +
  labs(x = "Date",
       y = "Daily Average Chlorophyll (mg m^-3)",
       title = "Daily Average Chlorophyll levels from East, West, and Santa Monica Buoys",
       color = "Location")
```

![](images/monthly_wind.png)

![](images/sst.png)

![](images/chlorophyll.png)

Distill is a publication format for scientific and technical writing, native to the web.

Learn more about using Distill at <https://rstudio.github.io/distill>.


